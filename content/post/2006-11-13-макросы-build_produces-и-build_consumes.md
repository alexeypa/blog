---
author: admin
date: 2006-11-13 22:09:16+00:00
excerpt: None
link: http://blog.not-a-kernel-guy.com/2006/11/13/98
slug: макросы-build_produces-и-build_consumes
title: Макросы BUILD_PRODUCES и BUILD_CONSUMES.
wordpress_id: 98
tags:
- Инструменты
- Программирование
---

Судя по всему, существует довольно распространённое заблуждение касательно использования макросов BUILD_PRODUCES и BUILD_CONSUMES в скриптах для стандартной утилиты build.exe из WDK. Напомню, что эти макросы служат для синхронизации сборки разных частей проекта на многопроцессорной машине. Например, если проект состоит из двух библиотек A и B, и библиотека B использует файлы, сгенерированные в процессе сборки A, то для корректной сборки такого проекта на однопроцессорной машине достаточно указать A перед B в dirs файле. В случае же многопроцессорной машины для синхронизации сборки A и B нужно дополнительно:

  * добавить BUILD_PRODUCES=A_lib в "A\sources";

  * добавить BUILD_CONSUMES=A_lib в "B\sources".

_Примечание: Строка "A_lib" в примере выше может быть заменена на любую другую. Следует лишь помнить, что каждое объявление BUILD_PRODUCES должно использовать уникальную строку._

Так вот, заблуждение состоит в том, что при использовании этих макросов порядок директорий в файле dirs может быть произвольным. На самом деле это не так и директория A должна по-прежнему указываться ранее директории B. Если порядок будет обратным, build.exe просто проигнорирует оба макроса. Проверить корректность использования BUILD_PRODUCES и BUILD_CONSUMES можно запустив build.exe с параметром **-verifysynchronization**. 

Ссылка по теме: [Building on a Multiprocessor Computer](http://www.osronline.com/DDKx/ddtools/build_use_4j5f.htm).
