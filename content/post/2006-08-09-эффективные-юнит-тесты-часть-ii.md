---
author: admin
comments: true
date: 2006-08-09 06:02:00+00:00
excerpt: None
link: http://blog.not-a-kernel-guy.com/2006/08/09/36
slug: эффективные-юнит-тесты-часть-ii
title: Эффективные юнит тесты. Часть II.
wordpress_id: 36
categories:
- itblogs
tags:
- Программирование
---

Реализация [алгоритма](http://blog.not-a-kernel-guy.com/wp-content/uploads/2006/08/EffectiveUnitTests.cpp), описанного в первой части. В принципе исходный код говорит сам за себя. Остановлюсь на некоторых деталях.

<!-- more -->Каждый элементарный тест описывается структурой:

    
    <span class="c_KeywordANSI def_Keyword">struct</span> Test
    <span class="def_SymbolStrong def_Symbol">{</span>
        <span class="c_KeywordANSI.typenames c_KeywordANSI def_Keyword">const</span> <span class="c_KeywordANSI.typenames c_KeywordANSI def_Keyword">char</span><span class="c_Symbol def_Symbol">*</span> name<span class="c_StructureSymbol def_SymbolStrong def_Symbol">;</span>
        <span class="c_KeywordANSI.typenames c_KeywordANSI def_Keyword">unsigned</span> type<span class="c_StructureSymbol def_SymbolStrong def_Symbol">;</span>
        <span class="c_KeywordANSI.typenames c_KeywordANSI def_Keyword">unsigned</span> mask<span class="c_StructureSymbol def_SymbolStrong def_Symbol">;</span>
        <span class="c_KeywordANSI.typenames c_KeywordANSI def_Keyword">bool</span> positive<span class="c_StructureSymbol def_SymbolStrong def_Symbol">;</span>
        <span class="c_KeywordANSI.typenames c_KeywordANSI def_Keyword">bool</span> <span class="c_Symbol def_Symbol">(</span><span class="c_Symbol def_Symbol">*</span>tearUp<span class="c_Symbol def_Symbol">)</span><span class="c_Symbol def_Symbol">(</span><span class="c_Symbol def_Symbol">)</span><span class="c_StructureSymbol def_SymbolStrong def_Symbol">;</span>
        <span class="c_KeywordANSI.typenames c_KeywordANSI def_Keyword">void</span> <span class="c_Symbol def_Symbol">(</span><span class="c_Symbol def_Symbol">*</span>tearDown<span class="c_Symbol def_Symbol">)</span><span class="c_Symbol def_Symbol">(</span><span class="c_Symbol def_Symbol">)</span><span class="c_StructureSymbol def_SymbolStrong def_Symbol">;</span>
    <span class="def_SymbolStrong def_Symbol">}</span><span class="c_StructureSymbol def_SymbolStrong def_Symbol">;</span>





	
  * name – задает имя теста. Имя желательно выбирать коротким, поскольку полное имя комбинации тестов включает в себя имена всех элементарных тестов;

	
  * type - одна из констант TEST_XXX или их комбинация, определяющая тип теста.  В примере  тип каждого теста уникален. На самом деле это необязательное требование;

	
  * mask – комбинация констант TEST_XXX перечисляющая все типы тестов, совместимые в данным;

	
  * positive – ожидаемый результат теста;

	
  * tearUp – функция, выполняющая инициализацию и собственно тест;

	
  * teadDown – функция, ответственная за корректное завершение теста.



Константы TEST_XXX представляют собой битовую маску, где каждому биту соотвествует свой тип теста. В процессе выбора очередного теста список выбранных тестов сопоставляется с маской совместимых тестов:


    
    <span class="c_KeywordANSI def_Keyword">if</span> <span class="c_Symbol def_Symbol">(</span>
        <span class="c_Symbol def_Symbol">(</span><span class="c_Symbol def_Symbol">(</span>mask <span class="c_Symbol def_Symbol">&</span> i<span class="c_Symbol def_Symbol">-</span><span class="c_Symbol def_Symbol">></span>type<span class="c_Symbol def_Symbol">)</span> <span class="c_Symbol def_Symbol">=</span><span class="c_Symbol def_Symbol">=</span> <span class="def_NumberDec def_Number">0</span><span class="c_Symbol def_Symbol">)</span> <span class="c_Symbol def_Symbol">&</span><span class="c_Symbol def_Symbol">&</span>
        <span class="c_Symbol def_Symbol">(</span><span class="c_Symbol def_Symbol">(</span>mask <span class="c_Symbol def_Symbol">&</span> <span class="c_Symbol def_Symbol">~</span><span class="c_Symbol def_Symbol">(</span>i<span class="c_Symbol def_Symbol">-</span><span class="c_Symbol def_Symbol">></span>type <span class="c_Symbol def_Symbol">|</span> i<span class="c_Symbol def_Symbol">-</span><span class="c_Symbol def_Symbol">></span>mask<span class="c_Symbol def_Symbol">)</span><span class="c_Symbol def_Symbol">)</span> <span class="c_Symbol def_Symbol">=</span><span class="c_Symbol def_Symbol">=</span> <span class="def_NumberDec def_Number">0</span><span class="c_Symbol def_Symbol">)</span><span class="c_Symbol def_Symbol">)</span>
    <span class="def_SymbolStrong def_Symbol">{</span>


Тест будет выбран только если тест еще не был выбран (первое условие), а также совместим с уже выбранными тестами. (второе условие).

В примере тесты групируются по категориям (или «вариантам»). Основной признак для такой группировки – в одну категорию попадают тесты, которые не могут входить ни в одну тестовую комбинацию одновременно.
